# int3rceptor - Dependency Vulnerability Fixes

**Generated:** 2026-01-07  
**Status:** In Progress  
**Total Vulnerabilities:** 5 + 6 warnings

---

## Vulnerability Summary

| Crate | Version | ID | Severity | Fix | Priority |
|-------|---------|-----|----------|-----|----------|
| cap-primitives | 2.0.2 | RUSTSEC-2024-0445 | LOW | Upgrade to >=3.4.1 | P3 |
| ring | 0.16.20 | RUSTSEC-2025-0009 | MODERATE | Upgrade to >=0.17.12 | P2 |
| wasmtime | 17.0.3 | RUSTSEC-2024-0438 | LOW | Upgrade to >=24.0.5 | P2 |
| wasmtime | 17.0.3 | RUSTSEC-2025-0046 | LOW | Upgrade to >=24.0.4 | P2 |
| wasmtime | 17.0.3 | RUSTSEC-2025-0118 | LOW | Upgrade to >=24.0.5 | P2 |
| rustls-pemfile | 2.2.0 | RUSTSEC-2025-0134 | WARNING | Upgrade to >=2.2.1+ | P3 |
| wasmtime-jit-debug | 17.0.3 | RUSTSEC-2024-0442 | WARNING | Upgrade wasmtime | P3 |

---

## Critical Issues

### 1. ring 0.16.20 - AES Panic on Overflow (MODERATE)
**CVE:** CVE-2025-4432  
**Impact:** Denial of Service through panic in AES-256-GCM functions

**Details:**
- May panic when overflow checking is enabled
- In QUIC: attacker can trigger via malformed packet (1 in 2^32 packets)
- For AES-128/256-GCM: requires ~64GB data in single chunk (unlikely in practice)
- **Our Usage:** ring is used via `rcgen` for certificate generation (low runtime risk)

**Fix:** Upgrade `rcgen` from 0.12 to 0.13+
```toml
rcgen = { version = "0.13", features = ["x509-parser", "pem"] }
```

**Testing:**
- Build with `RUSTFLAGS="-C overflow-checks"` to verify
- Test certificate generation works

---

### 2. wasmtime 17.0.3 - Multiple Vulnerabilities (3x LOW)

#### Issue A: Windows Device Filename Sandboxing
**ID:** RUSTSEC-2024-0438  
**Impact:** Plugin sandbox bypass on Windows via superscript device names

#### Issue B: fd_renumber Host Panic  
**ID:** RUSTSEC-2025-0046  
**Impact:** DoS if malicious WASM module calls fd_renumber

#### Issue C: Unsound API Access to Shared Memory
**ID:** RUSTSEC-2025-0118  
**Impact:** Data races in WebAssembly shared linear memory access

**Fix Strategy:**
Option A (Minimum): Upgrade to wasmtime 24.0.5
```toml
wasmtime = "24.0.5"
wasmtime-wasi = "24.0.5"
```

Option B (Modern): Upgrade to wasmtime 34.0.2 (2025 release)
```toml
wasmtime = "34.0"
wasmtime-wasi = "34.0"
```

**Recommendation:** Option B (34.0.2) for latest security fixes and performance

**Migration Notes:**
- API changes between 17.0 → 34.0 are minimal for our use case
- Main changes: module instantiation patterns
- Test all plugin loading paths

---

### 3. cap-primitives 2.0.2 - Windows Sandbox Bypass (LOW)
**ID:** RUSTSEC-2024-0445  
**Impact:** Windows-only path traversal via superscript digits

**Fix:** Indirect - fixed by upgrading `wasmtime` to 24.0+
- `wasmtime-wasi` depends on `cap-std` >=3.4.1
- Automatic upgrade when wasmtime updated

---

## Warning Issues

### 4. rustls-pemfile 2.2.0 - Unmaintained
**ID:** RUSTSEC-2025-0134  
**Status:** Unmaintained library

**Impact:** Low - only used for PEM parsing at startup  
**Fix:** Indirect through dependency upgrades

---

### 5. wasmtime-jit-debug 17.0.3 - Unsound Memory Dump
**ID:** RUSTSEC-2024-0442  
**Impact:** Debug info may contain undefined memory

**Fix:** Indirect - fixed by wasmtime upgrade to 24.0+

---

## Implementation Plan

### Phase 1: Update ring and rcgen (1 day)
```bash
# Step 1: Update workspace dependencies
# In Cargo.toml:
rcgen = { version = "0.13", features = ["x509-parser", "pem"] }

# Step 2: Build and test
cargo build --all
cargo test --all

# Step 3: Verify certificates still generate correctly
# Run integration tests
```

### Phase 2: Update wasmtime (1-2 days)
```bash
# Step 1: Update wasmtime dependencies
# In core/Cargo.toml:
wasmtime = "34.0"
wasmtime-wasi = "34.0"

# Step 2: Check for API breaking changes
# Review wasmtime changelog between 17.0 and 34.0
# Expected: Minor changes in module instantiation

# Step 3: Update plugin loading code if needed
# core/src/plugin/loader.rs - verify compatibility

# Step 4: Build and test
cargo build --all
cargo test --all
cargo test -p interceptor-core --lib plugin

# Step 5: Run plugin system tests
# Verify plugins still load and execute correctly
```

### Phase 3: Verification (1 day)
```bash
# Run full audit again
cargo audit

# Build with overflow checks
RUSTFLAGS="-C overflow-checks" cargo build --all

# Run full test suite
cargo test --all

# Security scanning
cargo clippy --all

# Push changes
git add Cargo.lock
git commit -m "[SECURITY] Update vulnerable dependencies

- Upgrade rcgen to 0.13+ (fix ring 0.16.20 AES panic)
- Upgrade wasmtime to 34.0+ (fixes 3 wasmtime vulnerabilities)
- Fixes CVSS moderate vulnerability (ring) and low vulnerabilities
"
git push origin main
```

---

## Dependency Update Tree

```
Before:
├── rcgen 0.12 → x509-parser 0.15.1 → ring 0.16.20 ❌
├── wasmtime 17.0.3 ❌
│   ├── cap-primitives 2.0.2 ❌
│   ├── cap-std 2.0.2 ❌
│   └── [other deps]
└── hyper-rustls 0.26 → [ok]

After:
├── rcgen 0.13 → x509-parser 0.16+ → ring 0.17.12+ ✅
├── wasmtime 34.0+ ✅
│   ├── cap-primitives 3.4.1+ ✅
│   ├── cap-std 3.4.1+ ✅
│   └── [other deps]
└── hyper-rustls 0.26 → [ok]
```

---

## Testing Checklist

### Ring/rcgen Updates
- [ ] `cargo build --all` succeeds
- [ ] Certificate generation works
- [ ] API tests pass
- [ ] Build with `RUSTFLAGS="-C overflow-checks"` succeeds
- [ ] Audit clean for ring vulnerabilities

### Wasmtime Updates
- [ ] `cargo build --all` succeeds
- [ ] Plugin system loads correctly
- [ ] Example plugins execute
- [ ] WASM memory isolation works
- [ ] Windows path validation (if on Windows)
- [ ] Audit clean for wasmtime vulnerabilities

### Full Suite
- [ ] `cargo test --all` passes
- [ ] `cargo audit` shows 0 vulnerabilities
- [ ] `cargo clippy --all` passes
- [ ] Integration tests pass
- [ ] No new compiler warnings

---

## Rollout Plan

1. **Local Testing:** All checks on dev machine
2. **CI/CD:** GitHub Actions runs audit + tests
3. **Branch:** Create feature branch for review
4. **Review:** Code review before merge
5. **Merge:** Squash merge with clean commit message
6. **Tag:** Create security patch tag (e.g., v2.0.1-security)

---

## Compatibility Notes

### rcgen 0.12 → 0.13
- API stable, no breaking changes
- Drop-in replacement

### wasmtime 17.0 → 34.0
- Some API changes but plugin system usage is compatible
- Main differences in `Module::new()` and `Instance::new()` params
- Our plugin loader should work with minimal changes
- Review: `core/src/plugin/loader.rs`

---

## Risk Assessment

| Change | Risk | Mitigation |
|--------|------|-----------|
| rcgen 0.13 | LOW | Direct dependency, mature, stable API |
| wasmtime 34.0 | MEDIUM | Transitive deps, major version bump | Test plugin system thoroughly |
| Overall | MEDIUM | Standard dependency updates | Full test suite, local verification first |

---

## Reference

- [ring vulnerability details](https://github.com/briansmith/ring/blob/main/RELEASES.md)
- [wasmtime security advisories](https://rustsec.org/advisories/?q=wasmtime)
- [rcgen changelog](https://github.com/rustls/rcgen/blob/main/CHANGELOG.md)

